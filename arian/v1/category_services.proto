syntax = "proto3";

package ariand.v1;

import "ariand/v1/category.proto";
import "google/protobuf/field_mask.proto";
import "google/protobuf/timestamp.proto";

option go_package = "ariand/gen/go/ariand/v1;ariandv1";

service CategoryService {
  rpc ListCategories(ListCategoriesRequest) returns (ListCategoriesResponse);
  rpc ListCategoriesWithUsage(ListCategoriesWithUsageRequest) returns (ListCategoriesWithUsageResponse);
  rpc ListCategoriesForUser(ListCategoriesForUserRequest) returns (ListCategoriesForUserResponse);
  rpc GetCategory(GetCategoryRequest) returns (GetCategoryResponse);
  rpc GetCategoryBySlug(GetCategoryBySlugRequest) returns (GetCategoryBySlugResponse);
  rpc GetCategoryWithStats(GetCategoryWithStatsRequest) returns (GetCategoryWithStatsResponse);
  rpc CreateCategory(CreateCategoryRequest) returns (CreateCategoryResponse);
  rpc BulkCreateCategories(BulkCreateCategoriesRequest) returns (BulkCreateCategoriesResponse);
  rpc UpdateCategory(UpdateCategoryRequest) returns (UpdateCategoryResponse);
  rpc DeleteCategory(DeleteCategoryRequest) returns (DeleteCategoryResponse);
  rpc DeleteUnusedCategories(DeleteUnusedCategoriesRequest) returns (DeleteUnusedCategoriesResponse);
  rpc GetCategoryUsageStats(GetCategoryUsageStatsRequest) returns (GetCategoryUsageStatsResponse);
  rpc GetCategoriesWithStats(GetCategoriesWithStatsRequest) returns (GetCategoriesWithStatsResponse);
  rpc SearchCategories(SearchCategoriesRequest) returns (SearchCategoriesResponse);
  rpc ListCategorySlugs(ListCategorySlugsRequest) returns (ListCategorySlugsResponse);
  rpc GetMostUsedCategoriesForUser(GetMostUsedCategoriesForUserRequest) returns (GetMostUsedCategoriesForUserResponse);
  rpc GetUnusedCategories(GetUnusedCategoriesRequest) returns (GetUnusedCategoriesResponse);
}

message ListCategoriesRequest {
  optional int32 limit = 1;
  optional int32 offset = 2;
  optional string filter = 3;
}

message ListCategoriesResponse {
  repeated Category categories = 1;
  int64 total_count = 2;
}

message GetCategoryRequest {
  int64 id = 1;
}

message GetCategoryResponse {
  Category category = 1;
}

message CreateCategoryRequest {
  string slug = 1;
  string label = 2;
  string color = 3;
}

message CreateCategoryResponse {
  Category category = 1;
}

message UpdateCategoryRequest {
  int64 id = 1;
  google.protobuf.FieldMask update_mask = 2;
  
  optional string slug = 3;
  optional string label = 4;
  optional string color = 5;
}

message UpdateCategoryResponse {
  Category category = 1;
}

message DeleteCategoryRequest {
  int64 id = 1;
}

message DeleteCategoryResponse {
  int64 affected_rows = 1;
}

message GetCategoryUsageStatsRequest {
  int64 category_id = 1;
  string user_id = 2;
  optional google.protobuf.Timestamp start_date = 3;
  optional google.protobuf.Timestamp end_date = 4;
}

message GetCategoryUsageStatsResponse {
  Category category = 1;
}

message GetCategoriesWithStatsRequest {
  string user_id = 1;
  optional google.protobuf.Timestamp start_date = 2;
  optional google.protobuf.Timestamp end_date = 3;
  optional int32 limit = 4;
  optional int32 offset = 5;
}

message GetCategoriesWithStatsResponse {
  repeated Category categories = 1;
  int64 total_count = 2;
}

message SearchCategoriesRequest {
  string query = 1;
  optional int32 limit = 2;
  optional int32 offset = 3;
}

message SearchCategoriesResponse {
  repeated Category categories = 1;
  int64 total_count = 2;
}

message ListCategoriesWithUsageRequest {
  optional int32 limit = 1;
  optional int32 offset = 2;
}

message ListCategoriesWithUsageResponse {
  repeated CategoryWithUsage categories = 1;
  int64 total_count = 2;
}

message ListCategoriesForUserRequest {
  string user_id = 1;
  optional int32 limit = 2;
  optional int32 offset = 3;
}

message ListCategoriesForUserResponse {
  repeated CategoryWithUserUsage categories = 1;
  int64 total_count = 2;
}

message GetCategoryBySlugRequest {
  string slug = 1;
}

message GetCategoryBySlugResponse {
  Category category = 1;
}

message GetCategoryWithStatsRequest {
  int64 id = 1;
}

message GetCategoryWithStatsResponse {
  Category category = 1;
  CategoryStats stats = 2;
}

message BulkCreateCategoriesRequest {
  repeated CreateCategoryRequest categories = 1;
}

message BulkCreateCategoriesResponse {
  repeated Category categories = 1;
  int64 affected_rows = 2;
}

message DeleteUnusedCategoriesRequest {}

message DeleteUnusedCategoriesResponse {
  int64 affected_rows = 1;
}

message ListCategorySlugsRequest {}

message ListCategorySlugsResponse {
  repeated string slugs = 1;
}

message GetMostUsedCategoriesForUserRequest {
  string user_id = 1;
  optional google.protobuf.Timestamp start_date = 2;
  optional google.protobuf.Timestamp end_date = 3;
  optional int32 limit = 4;
}

message GetMostUsedCategoriesForUserResponse {
  repeated CategoryWithUsage categories = 1;
}

message GetUnusedCategoriesRequest {}

message GetUnusedCategoriesResponse {
  repeated Category categories = 1;
}